{
  "template":{
    "body":[
      {
        "componentType":"instance",
        "persistentVolumeClaims":null,
        "deployments":[
          {
            "kind":"Deployment",
            "apiVersion":"extensions/v1beta1",
            "metadata":{
              "name":"se-$idx_and_short_instance_id",
              "labels":{
                "plan_id":"$plan_id",
                "offering_id":"$offering_id",
                "idx_and_short_instance_id":"$idx_and_short_instance_id",
                "managed_by":"TAP",
                "org":"$org",
                "instance_id":"$instance_id",
                "space":"$space"
              }
            },
            "spec":{
              "replicas":1,
              "selector":{
                "matchLabels":{
                  "idx_and_short_instance_id":"$idx_and_short_instance_id",
                  "instance_id":"$instance_id"
                }
              },
              "template":{
                "metadata":{
                  "labels":{
                    "idx_and_short_instance_id":"$idx_and_short_instance_id",
                    "managed_by":"TAP",
                    "instance_id":"$instance_id"
                  }
                },
                "spec":{
                  "containers":[
                    {
                      "name":"scoring-pipelines",
                      "image":"$repository_uri/scoring-engine:$tap_version",
                      "resources":{
                        "limits":{
                          "memory":"1Gi"
                        },
                        "requests":{
                          "memory":"1Gi"
                        }
                      },
                      "ports":[
                        {
                          "containerPort":9100,
                          "protocol":"TCP"
                        }
                      ],
                      "env":[
                        {
                          "name":"MANAGED_BY",
                          "value":"TAP"
                        },
                        {
                          "name":"SCORING_ENGINE_SERVICE_NAME",
                          "value":"se-$idx_and_short_instance_id"
                        },
                        {
                          "name":"KAFKA_URI",
                          "valueFrom":{
                            "configMapKeyRef":{
                              "name":"cloudera-config",
                              "key":"kafka.uri"
                            }
                          }
                        },
                        {
                          "name":"KAFKA_ZK_CLUSTER_HOST",
                          "valueFrom":{
                            "configMapKeyRef":{
                              "name":"cloudera-config",
                              "key":"kafka.zookeeper.cluster.host"
                            }
                          }
                        }
                      ],
                      "imagePullPolicy":"IfNotPresent"
                    }
                  ],
                  "restartPolicy":"Always",
                  "dnsPolicy":"ClusterFirst",
                  "serviceAccountName":""
                }
              },
              "strategy":{

              }
            },
            "status":{

            }
          }
        ],
        "services":[
          {
            "kind":"Service",
            "apiVersion":"v1",
            "metadata":{
              "name":"se-$idx_and_short_instance_id",
              "creationTimestamp":null,
              "labels":{
                "plan_id":"$plan_id",
                "offering_id":"$offering_id",
                "idx_and_short_instance_id":"$idx_and_short_instance_id",
                "managed_by":"TAP",
                "org":"$org",
                "instance_id":"$instance_id",
                "instance_name":"$instance_name",
                "space":"$space"
              }
            },
            "spec":{
              "type":"ClusterIP",
              "ports":[
                {
                  "protocol":"TCP",
                  "port":80,
                  "targetPort":9100
                }
              ],
              "selector":{
                "instance_id":"$instance_id"
              }
            },
            "status":{
              "loadBalancer":{

              }
            }
          }
        ],
        "serviceAccounts":[
          {
            "kind":"ServiceAccount",
            "apiVersion":"extensions/v1beta1",
            "metadata":{
              "name":"$idx_and_short_instance_id",
              "creationTimestamp":null,
              "labels":{
                "plan_id":"$plan_id",
                "offering_id":"$offering_id",
                "idx_and_short_instance_id":"$idx_and_short_instance_id",
                "managed_by":"TAP",
                "org":"$org",
                "instance_id":"$instance_id",
                "instance_name":"$instance_name",
                "space":"$space"
              }
            },
            "secrets":null
          }
        ],
        "ingresses":[
          {
            "apiVersion":"extensions/v1beta1",
            "kind":"Ingress",
            "metadata":{
              "name":"se-$idx_and_short_instance_id",
              "labels":{
                "plan_id":"$plan_id",
                "offering_id":"$offering_id",
                "managed_by":"TAP",
                "org":"$org",
                "instance_id":"$instance_id",
                "instance_name":"$instance_name",
                "space":"$space"
              }
            },
            "spec":{
              "rules":[
                {
                  "host":"$instance_name.$domain_name",
                  "http":{
                    "paths":[
                      {
                        "path":"/",
                        "backend":{
                          "serviceName":"se-$idx_and_short_instance_id",
                          "servicePort":80
                        }
                      }
                    ]
                  }
                }
              ]
            }
          }
        ]
      }
    ]
  },
  "services":[
    {
      "name":"scoring-engine",
      "description":"Scoring engine for Spark models.",
      "metadata":[
        {
          "key":"displayName",
          "value":"Scoring Engine"
        },
        {
          "key":"imageUrl",
          "value":""
        },
        {
          "key":"longDescription",
          "value":"Scoring engine for Spark models"
        },
        {
          "key":"providerDisplayName",
          "value":"Scoring Engine"
        },
        {
          "key":"documentationUrl",
          "value":"https://github.com/trustedanalytics-ng/scoring-engine"
        },
        {
          "key":"supportUrl",
          "value":"https://github.com/trustedanalytics-ng/scoring-engine"
        }
      ],
      "bindable":true,
      "tags":[
        "se",
        "scoring-engine"
      ],
      "plans":[
        {
          "name":"single",
          "description":"Create a single instance of Scoring Engine. Resources Used: 1 Compute Node and 1 Gb of memory. No persistent volumes are attached to this instance.",
          "cost":"free"
        }
      ]
    }
  ]
}
